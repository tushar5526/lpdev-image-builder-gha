name: LP dev image test workflow - test

on:
  workflow_dispatch:

jobs:
  build-and-upload:
    runs-on: ubuntu-latest
    steps:
    - name: Create dummy LXD image file
      run: |
        mkdir -p artifacts
        echo "This is a test LXD image file" > artifacts/launchpad-dev.tar.xz
        echo "file_path=$PWD/artifacts/launchpad-dev.tar.xz" >> $GITHUB_ENV

    - name: Delete existing release
      run: |
        gh release delete latest -y || true
        git tag -d latest || true
        git push origin :refs/tags/latest || true
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: Create/Update Release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: latest
        release_name: "Latest Launchpad Dev Image (Test)"
        files: ${{ env.file_path }}
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
